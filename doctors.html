<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Doctors - Hospital Management System</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/assets.css" rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">üè• Hospital Management System</a>
      <div class="navbar-nav">
        <a class="nav-link" href="/"><i class="bi bi-house"></i> Home</a>
        <a class="nav-link" href="/patients.html"><i class="bi bi-people"></i> Patients</a>
        <a class="nav-link active" href="/doctors.html"><i class="bi bi-person-badge"></i> Doctors</a>
        <a class="nav-link" href="/appointments.html"><i class="bi bi-calendar-event"></i> Appointments</a>
        <a class="nav-link" href="/admin.html"><i class="bi bi-shield-lock"></i> Admin</a>
        <a class="nav-link" href="/signup.html"><i class="bi bi-person-plus"></i> Signup</a>
        <a class="nav-link" href="/login.html"><i class="bi bi-box-arrow-in-right"></i> Login</a>
        <span id="navUser" class="navbar-text ms-2"></span>
      </div>
    </div>
  </nav>
  <div class="container py-4">
    <h2 class="mb-3">Doctors</h2>
    <div class="row">
      <div class="col-md-4">
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="d-flex align-items-center gap-2"><i class="bi bi-person-badge"></i> Add Doctor</h5>
            <input id="doctorName" class="form-control my-1" placeholder="Name">
            <input id="doctorSpecialty" class="form-control my-1" placeholder="Specialty">
            <input id="doctorContact" class="form-control my-1" placeholder="Contact">
            <button id="addDoctorBtn" class="btn btn-success mt-2">Add Doctor</button>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-2">All Doctors</h5>
            <input id="doctorFilter" class="form-control form-control-sm" placeholder="Search" style="width:200px">
          </div>
          <div class="table-responsive">
            <table class="table table-dark table-striped align-middle" id="doctorsTable">
              <thead><tr><th>Name</th><th>Specialty</th><th>Contact</th><th style="width:120px">Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
<div id="toastContainer" class="toast-container"></div>
<script src="/assets.js"></script>
<script>
const API = (location.port === '5000' ? '/api' : 'http://127.0.0.1:5000/api');
async function fetchJson(path, opts){
  const res = await fetch(API + path, opts);
  if(!res.ok){
    const ct = res.headers.get('content-type') || '';
    let msg;
    if(ct.includes('application/json')){
      const j = await res.json(); msg = j.error || j.message || res.statusText;
    } else {
      msg = (await res.text()) || res.statusText;
    }
    throw new Error(msg);
  }
  return res.json();
}
async function loadDoctors(){
  const doctors = await fetchJson('/doctors');
  const body = document.querySelector('#doctorsTable tbody');
  body.innerHTML = '';
  if(doctors.length===0){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td colspan="4" class="empty">No doctors</td>`;
    body.appendChild(tr);
  }else{
    doctors.forEach(d=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${d.name}</td><td>${d.specialty||''}</td><td>${d.contact||''}</td>
                      <td><button class="btn btn-sm btn-danger" onclick="deleteDoctor('${d.id}')"><i class="bi bi-trash"></i></button></td>`;
      body.appendChild(tr);
    });
  }
}
async function addDoctor(){
  const name = document.getElementById('doctorName').value.trim();
  const specialty = document.getElementById('doctorSpecialty').value.trim();
  const contact = document.getElementById('doctorContact').value.trim();
  if(!name) return alert('Name required');
  document.getElementById('addDoctorBtn').disabled = true;
  await fetchJson('/doctors', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name, specialty, contact})});
  document.getElementById('doctorName').value='';
  document.getElementById('doctorSpecialty').value='';
  document.getElementById('doctorContact').value='';
  document.getElementById('addDoctorBtn').disabled = false;
  showToast('Doctor added', 'success');
  loadDoctors();
}
async function deleteDoctor(id){
  if(!confirm('Delete doctor and related appointments?')) return;
  await fetchJson(`/doctors/${id}`, {method:'DELETE'});
  showToast('Doctor deleted', 'warning');
  loadDoctors();
}
document.getElementById('addDoctorBtn').addEventListener('click', addDoctor);
document.getElementById('doctorFilter').addEventListener('input', e=>{
  const q = e.target.value.toLowerCase();
  document.querySelectorAll('#doctorsTable tbody tr').forEach(tr=>{
    if(tr.querySelector('.empty')) return;
    tr.style.display = tr.children[0].textContent.toLowerCase().includes(q) ? '' : 'none';
  })
})
loadDoctors();
</script>
</body>
</html>
